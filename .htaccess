# Enable URL rewriting
RewriteEngine On

# Set the base directory
RewriteBase /COURSE_SYSTEM/

# Protect sensitive directories
RewriteRule ^includes/ - [F,L]
RewriteRule ^database/ - [F,L]
RewriteRule ^config/ - [F,L]

# Redirect to index if directory exists
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^(.*)/$ /$1 [R=301,L]

# Remove .php extension
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.*)$ $1.php [L]

# Custom error pages
ErrorDocument 404 /COURSE_SYSTEM/404.php
ErrorDocument 403 /COURSE_SYSTEM/403.php
ErrorDocument 500 /COURSE_SYSTEM/500.php

# Security headers
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "SAMEORIGIN"
Header set X-XSS-Protection "1; mode=block"
Header set Referrer-Policy "strict-origin-when-cross-origin"

# Disable directory listing
Options -Indexes

# Protect against SQL injection
SetEnvIfNoCase User-Agent "libwww-perl.*" block_bad_bots
Deny from env=block_bad_bots

# Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>